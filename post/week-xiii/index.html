<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="A student studying Applied Computing">
<meta name="description" content="Life the universe and everything">
<meta name="generator" content="Hugo 0.24.1" />
<title>GSoC: The final phase</title>
<link rel="shortcut icon" href="https://dimitraz.github.io/blog/images/favicon.ico">
<link rel="stylesheet" href="https://dimitraz.github.io/blog/css/style.css">
<link rel="stylesheet" href="https://dimitraz.github.io/blog/css/highlight.css">



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">



<link href="https://dimitraz.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="dimitraz.github.io" />


<meta property="og:title" content="GSoC: The final phase" />
<meta property="og:description" content="Week 13 of Google Summer of Code" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dimitraz.github.io/blog/post/week-xiii/" />



<meta property="article:published_time" content="2017-08-23T13:16:04&#43;01:00"/>
<meta property="article:modified_time" content="2017-08-23T13:16:04&#43;01:00"/>













<meta itemprop="name" content="GSoC: The final phase">
<meta itemprop="description" content="Week 13 of Google Summer of Code">


<meta itemprop="dateModified" content="2017-08-23T13:16:04&#43;01:00" />
<meta itemprop="wordCount" content="621">



<meta itemprop="keywords" content="" />



  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="GSoC: The final phase"/>
<meta name="twitter:title" content="GSoC: The final phase"/>
<meta name="twitter:description" content="Week 13 of Google Summer of Code"/>



    </head>
<body>
    <nav class="main-nav">
	
		<a href='https://dimitraz.github.io/blog/'> <span class="arrow">‚Üê</span>Home</a>
	

	

	
		<a class="cta" href="https://dimitraz.github.io/blog/index.xml">Subscribe</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>GSoC: The final phase</h1>
        <h2 class="headline">
        August 23, 2017
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        

<p>Since the last Google Summer of Code post a few weeks ago in which I promised to post weekly, I&rsquo;ve mainly worked on the <code>kafka-cdi</code>
library, adding custom serializers/deserializers to automatically handle objects of any type <code>T</code>.</p>

<h3 id="generic-serializers-and-deserializers-for-kafka">Generic serializers and deserializers for Kafka</h3>

<p>I ran into every problem imaginable - null serializers, problems with the library and problems with abstract class serialization.
Here is the list of what was done:</p>

<ul>
<li><p>Added <code>GenericSerializer</code> and <code>GenericDeserializer</code> classes, which use Jackson&rsquo;s Json object mapper. I looked into <code>gson</code> as a possibility but Jackson was the better choice for what we needed. (Gson also doesn&rsquo;t enforce strict deserialization, which I&rsquo;m not a huge fan of) <a href="https://github.com/matzew/kafka-cdi/pull/17">#17</a>, plus an <a href="https://github.com/dimitraz/kafka-poc/commit/b797667b5d4c3d72704de10dbadcf18349e67a6d">example</a> of a generic gson ser/des.</p></li>

<li><p>Used Producer/Consumer overloaded serializer/deserializer constructors. It turns out that if you don&rsquo;t pass the serializers in manually, Kafka will attempt to construct them itself using the default constructor (no typing), which is quite obvious when you eventually get some distance from the problem! <a href="https://github.com/matzew/kafka-cdi/pull/17">#17</a></p></li>

<li><p>Default to generic serdes to handle unknown types (right now Apache only supports standard data types) <a href="https://github.com/matzew/kafka-cdi/pull/17">#17</a></p></li>

<li><p>Added unit tests for all classes in the serialization package <a href="https://github.com/matzew/kafka-cdi/pull/17">#17</a>, <a href="https://github.com/matzew/kafka-cdi/pull/23">#23</a></p></li>

<li><p>Added jackson type info for abstract classes (in our case, we only needed it for the <code>Variant</code> class and its subtypes) <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/889">#889</a></p></li>

<li><p>Matthias <a href="https://github.com/matzew/kafka-cdi/pull/16">refactored</a> the library&rsquo;s <code>DelegationKafkaConsumer</code> to support custom Consumers, which were previously only consuming records of type <code>String, String</code> <a href="https://github.com/matzew/kafka-cdi/pull/16">#16</a></p></li>
</ul>

<p>All PRs for this can be found here: <a href="https://github.com/matzew/kafka-cdi/pull/16">#16</a>, <a href="https://github.com/matzew/kafka-cdi/pull/17">#17</a>, <a href="https://github.com/matzew/kafka-cdi/pull/23">#23</a>, <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/889">#889</a>, plus an <a href="https://github.com/dimitraz/kafka-poc/commit/b797667b5d4c3d72704de10dbadcf18349e67a6d">example</a> of a generic gson ser/des.</p>

<p>And the mailing list threads: <a href="http://lists.jboss.org/pipermail/aerogear-dev/2017-August/012934.html">#1</a>, <a href="http://lists.jboss.org/pipermail/aerogear-dev/2017-August/012951.html">#2</a></p>

<h3 id="kafka-test-environment-for-ups-consumers-producers">Kafka test environment for UPS consumers / producers</h3>

<p>Polina worked on a more solid test environment which allows us to test real consumers/producers we are using in the UnifiedPush Server.</p>

<p>We&rsquo;re using Debezium for setting up the Kafka Cluster in the mock environment and Mockito and Arquillian for constructing our test jar with the dependencies we need.</p>

<p>So far the tests are working well but we&rsquo;re running into issues with circular dependencies, which means we&rsquo;re probably going to have to try rethink our <code>Kafka</code> module.</p>

<p>The PR for this can be found here: <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/895">#895</a></p>

<h3 id="jms-removal">JMS removal</h3>

<p>Matthias refactored the <code>Token Loader</code> class to replace the JMS queue with Kafka (<a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/894">#894</a>).
After this, (and given the possibility of being able to send any objects with the generic ser/des) we slowly started replacing the rest of the push message flow with Kafka consumers, producers and streams:</p>

<ul>
<li><p>We replaced the old notification router with a new streams based approach <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/900">#900</a></p></li>

<li><p>We added a producer in the <code>Push Notification Sender</code> endpoint, for producing messages read by the streams <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/896">#896</a></p></li>

<li><p>We added a consumer in the <code>Token Loader</code> class, which reads from the streams output topics <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/900/commits/0d5407e62ce8b15c1daabda29b56f2e2b85d6cf3">#900</a></p></li>

<li><p>We added a consumer in the <code>Notification Dispatcher</code> class, which consumes messages from the <code>MessageHolderWithTokens</code> producer. <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/894">#897</a>, <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/894">#894</a> (token loader producer)</p></li>
</ul>

<p>We still have to test everything against all variant types, which we&rsquo;re going to use the <a href="https://github.com/aerogear/ups-mock-data-loader">UPS mock data loader</a> for. I&rsquo;m still trying to get it working with a local server though.</p>

<h3 id="metrics-processing">Metrics processing</h3>

<p>Our plan for the next and last week of GSoC is to focus on logging responses and stats (for example, delivery successes and failures) to various topics for processing and analysis with Kafka streams at a later stage.
Polina has already come up with a few jiras (see our <a href="https://issues.jboss.org/issues/?jql=labels+%3D+gsoc_2017"><code>gsoc_2017</code></a> label) and we&rsquo;ve sent <a href="http://lists.jboss.org/pipermail/aerogear-dev/2017-August/012974.html">an email</a> to the mailing list asking for ideas from the community as well.</p>

<p>After that, we&rsquo;ll be publishing our final reports including what&rsquo;s left to do, and we&rsquo;ll probably be doing a &ldquo;wrap-up webinar&rdquo;, going through our thoughts on the last three months of work and giving a small demo on the final result. Stay tuned!</p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    
    <img class="avatar" src="https://dimitraz.github.io/blog/images/avatar.png">
    <div>
        <span class="dark">A student studying Applied Computing</span>
        <span></span>
    </div>
    
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdimitraz.github.io%2fblog%2fpost%2fweek-xiii%2f - GSoC%3a%20The%20final%20phase "><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dimitraz';
    var disqus_identifier = 'https:\/\/dimitraz.github.io\/blog\/post\/week-xiii\/';
    var disqus_title = 'GSoC: The final phase';
    var disqus_url = 'https:\/\/dimitraz.github.io\/blog\/post\/week-xiii\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="../../post/kubless-kafka/">Serverless on Kubernetes with Kubeless and Kafka<aside class="dates">Feb 3 2019</aside></a>
        </li>
    
        <li>
            <a href="../../post/internship/">Eight months at Red Hat Mobile<aside class="dates">Aug 22 2018</aside></a>
        </li>
    
        <li>
            <a href="../../post/outreach/">Approaching outreach<aside class="dates">Apr 6 2018</aside></a>
        </li>
    
        <li>
            <a href="../../post/gsoc-final-phase/">Google Summer of Code 2017<aside class="dates">Aug 27 2017</aside></a>
        </li>
    
        <li>
            <a href="../../post/week-x/">GSoC: Lessons from week 10<aside class="dates">Aug 8 2017</aside></a>
        </li>
    
        <li>
            <a href="../../post/phase-ii/">GSoC: The second evaluation phase<aside class="dates">Jul 28 2017</aside></a>
        </li>
    
        <li>
            <a href="../../post/ups-metrics/">Analysing the UnifiedPush Server<aside class="dates">Jul 25 2017</aside></a>
        </li>
    
        <li>
            <a href="../../post/docker-networking/">Docker for Mac networking<aside class="dates">Jul 19 2017</aside></a>
        </li>
    
        <li>
            <a href="../../post/welcome/">GSoC: First evaluation phase<aside class="dates">Jun 10 2017</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/dimitraz">
        <i class="fa fa-github"></i>
    </a>
    


</div>

    
    <p class="small">
    
        ¬© Copyright 2019 A student studying Applied Computing
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://dimitraz.github.io/blog/js/main.js"></script>
<script src="https://dimitraz.github.io/blog/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-102682982-1', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>
