<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="A student studying Applied Computing">
<meta name="description" content="Life the universe and everything">
<meta name="generator" content="Hugo 0.22.1" />
<title>Analysing the UnifiedPush Server</title>
<link rel="shortcut icon" href="https://dimitraz.github.io/blog/images/favicon.ico">
<link rel="stylesheet" href="https://dimitraz.github.io/blog/css/style.css">
<link rel="stylesheet" href="https://dimitraz.github.io/blog/css/highlight.css">



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">



<link href="https://dimitraz.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="dimitraz.github.io" />


<meta property="og:title" content="Analysing the UnifiedPush Server" />
<meta property="og:description" content="UPS Metrics with SonarQube and Structure101" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dimitraz.github.io/blog/post/ups-metrics/" />



<meta property="article:published_time" content="2017-07-25T13:16:04&#43;01:00"/>
<meta property="article:modified_time" content="2017-07-25T13:16:04&#43;01:00"/>













<meta itemprop="name" content="Analysing the UnifiedPush Server">
<meta itemprop="description" content="UPS Metrics with SonarQube and Structure101">


<meta itemprop="dateModified" content="2017-07-25T13:16:04&#43;01:00" />
<meta itemprop="wordCount" content="1199">



<meta itemprop="keywords" content="" />



  <meta name="twitter:card" content="summary"/>



<meta name="twitter:text:title" content="Analysing the UnifiedPush Server"/>
<meta name="twitter:title" content="Analysing the UnifiedPush Server"/>
<meta name="twitter:description" content="UPS Metrics with SonarQube and Structure101"/>



    </head>
<body>
    <nav class="main-nav">
	
		<a href='https://dimitraz.github.io/blog/'> <span class="arrow">‚Üê</span>Home</a>
	

	

	
		<a class="cta" href="https://dimitraz.github.io/blog/index.xml">Subscribe</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Analysing the UnifiedPush Server</h1>
        <h2 class="headline">
        July 25, 2017
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        

<p>Attempting to get familiarized with the UPS codebase and its under-the-hood intricacies is a pretty daunting task.
A good step in the right direction, for me at least, was attempting to analyse the metrics and the overall quality of the codebase.
Having a higher level overview of what is currently there and a vague idea of what can be improved upon is generally a good place to start.</p>

<p>So with that objective in mind we were recommended two tools in particular to play around with, Structure101 and SonarQube. I&rsquo;ll focus on the latter for now, taking a look at using it to perform a simple metrics based code analysis on the Unified Push Server.</p>

<h2 id="sonarqube">SonarQube</h2>

<p>SonarQube is definitely the least complicated of the two in terms of getting going quickly and is intuitive enough that you can start diving in straight away with small changes.</p>

<p>If you&rsquo;re having trouble installing it, <a href="https://polinankoleva.github.io/education/2017/07/13/install-sonar-qube.html">here&rsquo;s</a> a great guide to getting started.</p>

<p>In a very short amount of time, with the project configured correctly, you&rsquo;re presented with a nice looking dashboard that gives you an overview of your project&rsquo;s bugs, vulnerabilities, technical debt, test coverage and more:</p>

<p><a href="/blog/static/img/sonar-dash.png"><img src="/blog/static/img/sonar-dash.png" alt="SonarQube project dashboard" /></a></p>

<p>SonarQube has a variety of cool features to explore: the <code>issues</code> tab lists all of the main issues within the codebase (bugs, code smells and vulnerabilities), their level of importance, and even the estimated amount of time it would take to fix the issue. Clicking on each issue gives you an explanation of it and includes a nice example. Clicking on the class link shows you where each issue appears in that class and which lines are not covered by tests. The <code>rules</code> tab provides a huge list of rules &amp; best practices for a handful of different languages.</p>

<p><a href="/blog/static/img/sonar-issues.png"><img src="/blog/static/img/sonar-issues.png" alt="SonarQube issues" /></a></p>

<p>It goes without saying that the benefits of having a tool that not only tells you that you&rsquo;re doing something wrong, but gives you an <em>understanding</em> of <em>why</em> something you&rsquo;ve written is not considered best practice and <em>what</em> you can do to improve it, are unquantifiable.</p>

<h3 id="taking-a-look-at-the-ups">Taking a look at the UPS</h3>

<p>To analyse the UPS I configured the project properties (see <a href="https://github.com/aerogear/aerogear-unifiedpush-server/pull/865">here</a>) and simply ran <code>sonar-scanner</code>.
I did bump my head a bit with JaCoCo and generating the code coverage report, which was overcome by firstly updating the version to the latest, and secondly enabling the <code>code-coverage</code> maven profile (the UPS already had JaCoCo installed, but not enabled by default):
<code>mvn -Ptest,code-coverage clean install</code>.</p>

<p>With the report being generated I could update the <code>sonar-project.properties</code> file to point to the jacoco executable, allowing us to see the total code coverage on the Sonar dashboard.</p>

<p>Overall, the UPS holds up quite well:</p>

<ul>
<li><p>There are <strong>198 code smells</strong>, or minor issues, which average to 2 days of technical debt. That&rsquo;s less than a 5% technical debt ratio which I think is pretty impressive! A lot of these have to do with code style &amp; best practices (for example, renaming constants to match the regular expression <code>^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$</code>, or not nesting more than 3 <code>if</code> statements).</p></li>

<li><p>There are <strong>79 bugs</strong>, some major, some minor, and a few blockers. A significant amount of these are related to rethrowing/logging unlogged exceptions, or statements that haven&rsquo;t been properly closed.</p></li>

<li><p>There are <strong>3 vulnerabilities</strong>, 2 of which related again to logging exceptions, this time which have been printed to the default <code>System.Err</code> stream with the <code>Throwable.printStackTrace</code> method. SonarQube points out that this could inadvertently expose sensitive information, which is why it is considered a vulnerability - something I had no idea about before now. The last vulnerability is related to password security in the <code>HttpBasicHelper</code> class in the <code>rest</code> module.</p></li>

<li><p>Code coverage is only at 33.7%, which leaves room for improvement, and is something myself &amp; Polina now know we should be aware of with whatever we implement in the future.</p></li>
</ul>

<p>With a static code analysis in place and a good idea of the overall code quality, we can now look at the structure and architecture of the code base, using Structure101.</p>

<h2 id="structure101">Structure101</h2>

<p>I&rsquo;ll admit that Structure101 can be quite confusing to get to grips with. Jumping right in and investigating the different options and what they do is probably the best way to get started.</p>

<p>There&rsquo;s a multitude of different features to explore in Structure101. A good one to take a look at is the <code>summary</code> tab. It breaks the project down and analyses the size, architecture and model of the project, the structural complexity, the tangles and fat percentage (which I&rsquo;ll get to later) at package, class and method levels, and where exactly these issues are occurring.</p>

<h3 id="getting-started">Getting started</h3>

<p>Once you&rsquo;ve installed Structure101, select your project type (I chose maven obviously) and experiment with selecting different options on the startup screen.<br />
You&rsquo;ll be presented with a graph in the top left corner which represents structural complexity of the project. The y-axis measures the <code>tangled</code> percentage (i.e. cyclic dependencies), while the x-axis measures the <code>fat</code> percentage (i.e. the overall number of dependencies). The lower the tangle measure and the lower the fat percentage the more structured a project is likely to be.</p>

<p style="text-align: center;">
    <a href="/blog/static/img/graph.png"><img style="width: 60%; text-align: center; margin: 0 auto" src="/blog/static/img/graph.png"></a>
</p>

<p>Underneath the graph you&rsquo;ll get a list of the main culprits causing tangles/fat in your project. Double clicking on one of these will take you to the exact location in your project structure which is displaying the problem.</p>

<p>As an example, I&rsquo;ll look at a tangle in the UPS, under the <code>model/api</code> module, in the <code>api</code> package: double clicking on the tangle in the left panel takes me to the exact package, where I can see there are actually two tangles (but I&rsquo;ll focus on the second):</p>

<p><a href="/blog/static/img/tangles.png"><img src="/blog/static/img/tangles.png" alt="Structure101 tangle" /></a></p>

<p>Double clicking on the blue arrow gives me more details about the tangle. In this case, there&rsquo;s a cyclic dependency between the <code>VariantMetricInformation</code> class and the the <code>PushMessageInformation</code> class. Both classes are referencing each other:</p>

<p><a href="/blog/static/img/tangle-info.png"><img src="/blog/static/img/tangle-info.png" alt="Structure101 tangle info" /></a></p>

<h3 id="taking-a-look-at-the-ups-1">Taking a look at the UPS</h3>

<p>Once again it&rsquo;s cool to see how well the UPS performs on a structural level:</p>

<ul>
<li><p>Excessive Structural Complexity (XS) is 1%</p></li>

<li><p>There are only 4 tangles at the design level (i.e. high-level packages)</p></li>

<li><p>No items exceed the fat threshold at the design, leaf-package or class level</p></li>

<li><p>Only 1 item exceeds the fat threshold at the method level</p></li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>While Structure101 and SonarQube are great tools for project analysis, they&rsquo;re not a silver bullet. I think their most important function is giving the user a good <em>starting point</em> to strategically and logically analyse their codebase, getting insight into the underlying flaws that may or may not exist at a structural or syntactical level. Accepting suggestions blindly probably won&rsquo;t lead to lasting solutions.</p>

<h2 id="good-first-bug">Good first bug</h2>

<p>There&rsquo;s an Aerogear <a href="https://issues.jboss.org/issues/?filter=12332262">jira label</a> called <code>good_first_bug</code> for anyone who&rsquo;s looking at getting started with Open Source contribution. Next to that, SonarQube is probably one of the best places to start in terms of small contributions that could make a huge improvement to the quality of the codebase.</p>

<p>Other than that I can highly recommend getting a few of your old projects set up with SonarQube and Structure101, going through the bugs and vulnerabilities, seeing what mistakes you&rsquo;ve potentially made and then improving on them! It&rsquo;s a great way to solidify your knowledge and enhance the quality of your projects.</p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    
    <img class="avatar" src="https://dimitraz.github.io/blog/images/avatar.png">
    <div>
        <span class="dark">A student studying Applied Computing</span>
        <span></span>
    </div>
    
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdimitraz.github.io%2fblog%2fpost%2fups-metrics%2f - Analysing%20the%20UnifiedPush%20Server "><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dimitraz';
    var disqus_identifier = 'https:\/\/dimitraz.github.io\/blog\/post\/ups-metrics\/';
    var disqus_title = 'Analysing the UnifiedPush Server';
    var disqus_url = 'https:\/\/dimitraz.github.io\/blog\/post\/ups-metrics\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/blog/post/docker-networking/">Docker for Mac networking<aside class="dates">Jul 19 2017</aside></a>
        </li>
    
        <li>
            <a href="/blog/post/welcome/">The evaluation phase<aside class="dates">Jun 10 2017</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/dimitraz">
        <i class="fa fa-github"></i>
    </a>
    


</div>

    
    <p class="small">
    
        ¬© Copyright 2017 A student studying Applied Computing
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://dimitraz.github.io/blog/js/main.js"></script>
<script src="https://dimitraz.github.io/blog/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-102682982-1', 'auto');
ga('send', 'pageview');
</script>


</body>
</html>
